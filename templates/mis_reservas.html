{% extends 'base.html' %}
{% load static %}

{% block title %}Mis Reservas - Centro de Psicología{% endblock %}
{% block page_title %}Mis Reservas{% endblock %}

{% block content %}
<div class="main-layout">
    <div class="calendar-wrapper" style="flex:1;min-width:300px;">
        <div class="calendar-header" style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
            <button id="prev-week" class="btn">◀</button>
            <div id="calendar-month" style="font-weight:700"></div>
            <button id="next-week" class="btn">▶</button>
        </div>
        <div id="calendar" style="border:1px solid #e6e6e6;padding:12px;border-radius:6px;background:#fff"></div>
    </div>
    <div class="reservations-container" style="flex:0 0 360px;min-width:280px">
        <h2>Mis Reservas</h2>

        {% if reservas %}
            <div id="my-reservations-list" class="reservations-list">
                {% for reserva in reservas %}
                    <div class="reservation-item" data-key="{{ reserva.fecha|date:'N' }}|{{ reserva.fecha|date:'H:i' }}|{{ reserva.profesional.nombre }}">
                        <strong>{{ reserva.profesional.nombre }}</strong>
                        <div class="reservation-meta">{{ reserva.fecha|date:"d/m/Y H:i" }}</div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No tienes reservas actualmente.</p>
        {% endif %}

        <div class="actions" style="margin-top: 20px;">
            <a href="{% url 'reservar' %}" class="btn btn-primary">Nueva reserva</a>
            <a href="{% url 'home' %}" class="btn btn-secondary">Volver al inicio</a>
        </div>
    </div>
</div>

{% block extra_scripts %}
  <script>
    window.djangoData = window.djangoData || {};
    {% if reservations_json %}
      try { window.djangoData.reservations = JSON.parse(`{{ reservations_json|escapejs }}`); } catch(e) { window.djangoData.reservations = {}; }
    {% else %}
      window.djangoData.reservations = {};
    {% endif %}
  </script>
  <script src="{% static 'js/mis-reservas-django.js' %}"></script>
{% endblock %}
{% endblock %}